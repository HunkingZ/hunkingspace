<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radio Player</title>
    <link rel="stylesheet" href="styles/general.css">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #000000;
            overflow: hidden; /* Prevent scrollbars */
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh; /* Full height of the viewport */
        }
        .info-bar {
            width: 100%;
            padding: 15px 20px;
            background: linear-gradient(90deg, rgba(0, 0, 0, 0.9), rgba(50, 50, 50, 0.9));
            color: #ffffff;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 500;
            position: absolute;
            top: 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        .info-bar span {
            display: inline-block;
            margin: 0 10px;
        }
        .info-bar span.icon {
            font-size: 1.5rem;
            vertical-align: middle;
        }
        .player-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Ensures the video fits within the container without distortion */
        }
    </style>
</head>
<body>
    <header class="info-bar" id="infoBar">
        Loading location, weather, and time...
    </header>
    <main class="player-container">
        <video id="videoPlayer" autoplay muted loop>
            <source src="videos/lofi1.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </main>
    <script src="config.js"></script> <!-- Include the config.js file -->
    <script>
        // Get video and audio elements
        const video = document.getElementById('videoPlayer');
        const audio = new Audio('audios/rainy-lofi1.mp3');

        // Ensure audio is allowed to play (fix autoplay restrictions)
        const enableAudio = () => {
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
            });
            document.removeEventListener('click', enableAudio);
        };

        // Add a user interaction listener to enable audio
        document.addEventListener('click', enableAudio);

        // Play audio when the video starts
        video.addEventListener('play', () => {
            if (audio.paused) {
                audio.play().catch(error => {
                    console.error('Audio playback failed:', error);
                });
            }
        });

        // Pause audio when the video pauses
        video.addEventListener('pause', () => {
            audio.pause();
        });

        // Restart audio when it finishes
        audio.addEventListener('ended', () => {
            audio.currentTime = 0; // Reset audio to the beginning
            audio.play().catch(error => {
                console.error('Audio playback failed:', error);
            });
        });

        // Allow the video to loop naturally without restarting the audio
        video.loop = true;

        // Fetch and display location, weather, and time
        const infoBar = document.getElementById('infoBar');
        const updateTime = () => {
            const now = new Date();
            return now.toLocaleTimeString();
        };

        const fetchLocationAndWeather = async () => {
            try {
                // Fetch location using Geolocation API
                navigator.geolocation.getCurrentPosition(async (position) => {
                    const { latitude, longitude } = position.coords;

                    // Fetch weather data using OpenWeatherMap API
                    const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${latitude}&lon=${longitude}&units=metric&appid=${openWeatherAPI}`);
                    const weatherData = await weatherResponse.json();

                    const location = weatherData.name;
                    const temperature = weatherData.main.temp;
                    const weather = weatherData.weather[0].description;

                    // Update the info bar
                    infoBar.textContent = `Location: ${location} | Weather: ${temperature}Â°C, ${weather} | Time: ${updateTime()}`;
                });
            } catch (error) {
                console.error('Failed to fetch location or weather:', error);
                infoBar.textContent = 'Unable to load location or weather.';
            }
        };

        // Update time every second
        setInterval(() => {
            const currentText = infoBar.textContent;
            const timeIndex = currentText.lastIndexOf('| Time:');
            if (timeIndex !== -1) {
                infoBar.textContent = currentText.slice(0, timeIndex) + ` | Time: ${updateTime()}`;
            }
        }, 1000);

        // Fetch location and weather on page load
        fetchLocationAndWeather();
    </script>
</body>
</html>